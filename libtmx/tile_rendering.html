<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>libtmx: How to render tiles with libtmx?</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libtmx
   &#160;<span id="projectnumber">0.3.1</span>
   </div>
   <div id="projectbrief">an C++11 library for reading TMX files</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">How to render tiles with libtmx? </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><code>libtmx</code> provides some useful tools for rendering tiles from a TMX map, even if <code>libtmx</code> is not itself a rendering library. This tutorial provides some hints on how to render tiles in a neutral way. You will have to adapt to your drawing toolkit. More precisely, we assume you use a visitor and want to render a <code><a class="el" href="classtmx_1_1_tile_layer.html" title="A tile layer is a layer with tiles in cells. ">tmx::TileLayer</a></code>. Here is the procedure.</p>
<h2>Get the size of the final surface</h2>
<p>First step, let's get some information about the size of the map and the size of the tiles to compute the size of the resulting surface.</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> surface_width = map-&gt;getTileWidth() * map-&gt;getWidth();</div>
<div class="line"><span class="keywordtype">unsigned</span> surface_height = map-&gt;getTileHeight() * map-&gt;getHeight();</div>
</div><!-- fragment --><h2>Visit the layer</h2>
<p>Second step, we visit the tile layer.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> visitTileLayer(<span class="keyword">const</span> <a class="code" href="classtmx_1_1_map.html">tmx::Map</a>&amp; map, <span class="keyword">const</span> <a class="code" href="classtmx_1_1_tile_layer.html">tmx::TileLayer</a>&amp; layer)<span class="keyword"> override </span>{</div>
<div class="line">  <span class="keywordflow">if</span> (!layer.<a class="code" href="classtmx_1_1_layer.html#ae317c1c871f6fc034bea58c515b45dd0">isVisible</a>()) {</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">unsigned</span> k = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> cell : layer) {</div>
<div class="line">    <span class="keywordtype">unsigned</span> i = k % map.<a class="code" href="classtmx_1_1_map.html#ab8de5b6c6da7262ccb648eda58d464fa">getWidth</a>();</div>
<div class="line">    <span class="keywordtype">unsigned</span> j = k / map.<a class="code" href="classtmx_1_1_map.html#ab8de5b6c6da7262ccb648eda58d464fa">getWidth</a>();</div>
<div class="line">    assert(j &lt; map.<a class="code" href="classtmx_1_1_map.html#a05ceab4e1ad755cc857f2a6b2a96ec3f">getHeight</a>());</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> x = i * map.<a class="code" href="classtmx_1_1_map.html#a2eb439e0874103eb91a5ab3af2e7d8c7">getTileWidth</a>();</div>
<div class="line">    <span class="keywordtype">unsigned</span> y = j * map.<a class="code" href="classtmx_1_1_map.html#aa48b842310b2a4d5669a4486a46d32de">getTileHeight</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> gid = cell.getGID();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (gid != 0) {</div>
<div class="line">      drawGID(map, x, y, gid);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    k++;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>First, it's not necessary to render the layer if it's not visible. This visibility property can be set in Tiled. Then, we visit every cell in the layer. Cells are organised in a <a href="http://en.wikipedia.org/wiki/Row-major_order">row-major order</a>, so we can compute the column <code>i</code> and row <code>j</code> of the cell, and then the coordinates <code>x</code> and <code>y</code> of the tile in the rendering surface. Finally, if the <code>gid</code> is an actual <code>gid</code>, then we draw the tile.</p>
<h2>Draw each tile</h2>
<p>Third step, we draw each tile on the rendering surface.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> drawGID(<span class="keyword">const</span> <a class="code" href="classtmx_1_1_map.html">tmx::Map</a>&amp; map, <span class="keywordtype">unsigned</span> x, <span class="keywordtype">unsigned</span> y, <span class="keywordtype">unsigned</span> gid) {</div>
<div class="line">  <a class="code" href="classtmx_1_1_tile_set.html">tmx::TileSet</a> *tileset = map.<a class="code" href="classtmx_1_1_map.html#a6db29f19673490492046af2b61c92bf7">getTileSetFromGID</a>(gid);</div>
<div class="line">  gid = gid - tileset-&gt;<a class="code" href="classtmx_1_1_tile_set.html#ac62327a0ecd282f971b78b3656b04df2">getFirstGID</a>();</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (tileset-&gt;<a class="code" href="classtmx_1_1_tile_set.html#a4010483db89aa151e6554bfb7180e4a8">hasImage</a>()) {</div>
<div class="line">    <span class="comment">// Tiled Qt</span></div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classtmx_1_1_image.html">tmx::Image</a> *image = tileset-&gt;<a class="code" href="classtmx_1_1_tile_set.html#ae47b6dc5058a5b2a056947b182ba22d5">getImage</a>();</div>
<div class="line">    <span class="keyword">auto</span> texture = getTexture(image-&gt;<a class="code" href="classtmx_1_1_image.html#a51f691fdd2451ffa6f0b912d92410376">getSource</a>()); <span class="comment">// depends on the toolkit</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="structtmx_1_1_size.html">tmx::Size</a> size = image-&gt;<a class="code" href="classtmx_1_1_image.html#a7f96b95aed9bffa9b6d8a34bded079bf">getSize</a>();</div>
<div class="line">    <a class="code" href="structtmx_1_1_rect.html">tmx::Rect</a> rect = tileset-&gt;<a class="code" href="classtmx_1_1_tile_set.html#a63caf07c80c742d4699738505f8e1c0b">getCoords</a>(gid, size);</div>
<div class="line"></div>
<div class="line">    drawImage(x, y, texture, rect); <span class="comment">// depends on the toolkit</span></div>
<div class="line"></div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Tiled Java</span></div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classtmx_1_1_tile.html">tmx::Tile</a> *tile = tileset-&gt;<a class="code" href="classtmx_1_1_tile_set.html#aa1f1e9b80ec40970a002a2e851dd313f">getTile</a>(gid);</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="classtmx_1_1_image.html">tmx::Image</a> *image = tile-&gt;<a class="code" href="classtmx_1_1_tile.html#a71b46a5b190cfda745e1b992c41547ea">getImage</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keyword">auto</span> texture = getTexture(image-&gt;<a class="code" href="classtmx_1_1_image.html#a51f691fdd2451ffa6f0b912d92410376">getSource</a>()); <span class="comment">// depends on the toolkit</span></div>
<div class="line">    drawImage(x, y, texture); <span class="comment">// depends on the toolkit</span></div>
<div class="line"></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Once the tileset has been computed (according to the documentation of the TMX format), we can compute the id of the tile inside the tileset. Then, in the case of Tiled Qt (the newest version), we get the corresponding image of the tileset and we compute its size (if the size is not present in the TMX file, you must get it from the toolkit). With the id of the tileset and the size of the image, we can compute the rectangular part of the image where the tile is. Finally, we draw the tile on the rendering surface at the <code>(x,y)</code> coordinates.</p>
<p>In the case of Tiled Java, the process is a little bit different. We put it here for completeness, in case you have to deal with old TMX files.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="image_object_rendering.html">How to render image objects with libtmx?</a> </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 28 2015 17:54:08 for libtmx by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
